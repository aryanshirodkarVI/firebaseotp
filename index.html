<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" type="image/png" href="./assets/images/Shanazlogo.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100..900&display=swap" rel="stylesheet">
    <title>Shanaz CHS | Login</title>
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/fontawesome.css">

    <style>
        .contact-btn {
            background-color: #f66;
            color: white;
            font-weight: bold;
            font-size: 16px;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            cursor: pointer;
            text-transform: uppercase;
            margin-top: 20px;
        }
        .contact-btn:hover {
            background-color: #ff4d4d;
        }
    </style>
</head>
<body>
    <div class="container d-flex justify-content-center align-items-center" style="height: 100vh;">
        <div class="card shadow-lg p-4" style="max-width: 400px;">
            <div class="text-center mb-4">
                <img src="./assets/images/Shanazlogo.png" alt="Logo" style="width: 80px;">
                <h4>Login to Your Account</h4>
            </div>
            <form method="post">
                <div class="form-group">
                    <label for="number">Phone Number</label>
                    <input type="text" class="form-control" id="number" name="number" required>
                    <div id="recaptcha-container"></div>
                </div>
                <div class="form-group mt-3" id="otpSection" style="display: none;">
                    <label for="Verificationcode">OTP</label>
                    <input type="text" class="form-control" id="Verificationcode">
                </div>
                <button type="button" class="contact-btn" id="sendOtp">Send OTP</button>
                <button type="button" class="contact-btn" id="verifyOtp" style="display: none;">Verify OTP</button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCrejrafiIgYAQX7chK5vGY1bengUaVJnY",
            authDomain: "shanazchs-3e4f5.firebaseapp.com",
            projectId: "shanazchs-3e4f5",
            storageBucket: "shanazchs-3e4f5.appspot.com",
            messagingSenderId: "456218743301",
            appId: "1:456218743301:web:434f751f19b98d209b026c",
            measurementId: "G-7HSBD191LC"
        };

        firebase.initializeApp(firebaseConfig);
        let recaptchaVerifier;

        // Initialize reCAPTCHA
        window.onload = () => {
            recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');
            recaptchaVerifier.render();
        };

        // Send OTP
        document.getElementById('sendOtp').onclick = () => {
            const phoneNumber = document.getElementById('number').value.trim();
            
            fetch('check_phone.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ number: phoneNumber })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                if (data.exists) {
                    firebase.auth().signInWithPhoneNumber(phoneNumber, recaptchaVerifier)
                        .then(confirmationResult => {
                            window.confirmationResult = confirmationResult;
                            document.getElementById('otpSection').style.display = 'block';
                            document.getElementById('verifyOtp').style.display = 'inline-block';
                        })
                        .catch(error => alert('Error sending OTP: ' + error.message));
                } else {
                    alert('Phone number not registered.');
                }
            });
        };

        // Verify OTP
        document.getElementById('verifyOtp').onclick = () => {
            const otp = document.getElementById('Verificationcode').value.trim();
            
            window.confirmationResult.confirm(otp)
                .then(result => alert('Phone number verified!'))
                .catch(error => alert('Invalid OTP'));
        };
    </script>
</body>
</html>
